module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=18)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/punctuateSeries"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat.Component},,,function(t,e,n){"use strict";n.r(e);var o=n(3),r=n(0),a=n.n(r),i=n(5),s=n.n(i),c=n(6),u=n.n(c);function l(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var p=n(2),f=n.n(p),h=n(7),d=function(t){function e(){return t.apply(this,arguments)||this}return l(e,t),e.prototype.apiEndpoint=function(){return"/carving-contest/entries"+(this.exists?"/"+this.data.id:"")},e}(n.n(h)()(f.a,{name:f.a.attribute("name"),image:f.a.attribute("image"),createdAt:f.a.attribute("createdAt",f.a.transformDate),user:f.a.hasOne("user"),likes:f.a.hasMany("likes")})),v=n(8),g=n.n(v),x=n(1),w=n.n(x),y=n(9),b=n.n(y),C=n(10),k=n.n(C),P=n(4),S=n.n(P),E=n(11),B=n.n(E),M=n(12),_=n.n(M),j=n(13),O=n.n(j);function W(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var L=n(14),T=n.n(L),q=n(15),N=function(t){function e(){return t.apply(this,arguments)||this}l(e,t);var n=e.prototype;return n.init=function(){var e=this;t.prototype.init.call(this),this.previewContext=null;var n=document.createElement("canvas");n.width=426,n.height=426,this.imageSourceContext=n.getContext("2d");var o=new Image;o.src=app.forum.attribute("baseUrl")+"/assets/extensions/clarkwinkelmann-carving-contest/pumpkin.jpg",o.onload=function(){e.imageSourceContext.drawImage(o,0,0),e.updatePreview()};var r=document.createElement("canvas");r.width=426,r.height=426,this.drawContext=r.getContext("2d");var a=this.props.image();if(a){var i=new Image;i.src=a,i.onload=function(){e.drawContext.drawImage(i,0,0),e.updatePreview()},i.onerror=function(t){console.error("Error loading image",t)}}this.onmouseup=function(){e.drawEnabled=!1}},e.initProps=function(t){t.toolShape||(t.toolShape=m.prop()),t.toolWidth||(t.toolWidth=m.prop())},n.config=function(t){t||(document.addEventListener("mouseup",this.onmouseup),this.previewContext=this.element.querySelector("canvas").getContext("2d"),this.updatePreview())},n.onunload=function(){document.removeEventListener("mouseup",this.onmouseup)},n.view=function(){var t=this;return m(".CarvingContestPumpkin",m("canvas",{width:426,height:426,onmousedown:function(e){t.drawEnabled=!0,t.mouseMove(e)},onmousemove:this.mouseMove.bind(this),onmouseleave:function(){t.updatePreview()}}))},n.mouseMove=function(t){var e=t.target.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;this.drawEnabled&&(this.drawContext.fillStyle="#000",this.drawWithTool(this.drawContext,n,o,!0),this.props.image(this.drawContext.canvas.toDataURL("image/png"))),this.updatePreview({x:n,y:o})},n.drawWithTool=function(t,e,n,o){void 0===o&&(o=!1);var r=this.props.toolWidth();switch(this.props.toolShape()){case"circle":t.beginPath(),t.arc(e,n,r/2,0,2*Math.PI),o?t.fill():t.stroke();break;case"square":t.fillRect(e-r/2,n-r/2,r,r)}},n.updatePreview=function(t){if(void 0===t&&(t=null),this.previewContext){for(var e=this.imageSourceContext.getImageData(0,0,426,426),n=this.drawContext.getImageData(0,0,426,426),o=0;o<e.data.length;o+=4)n.data[o+3]>0&&(e.data[o]=0,e.data[o+1]=0,e.data[o+2]=0,e.data[o+3]=0);this.previewContext.clearRect(0,0,426,426),this.previewContext.putImageData(e,0,0),t&&(this.previewContext.strokeStyle="rgba(0,0,0,0.5)",this.previewContext.lineWidth=3,this.drawWithTool(this.previewContext,t.x,t.y))}},e}(n.n(q).a),D="clarkwinkelmann-carving-contest.forum.modal.",R=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return I(W(e=t.call.apply(t,[this].concat(o))||this),"toolShape",m.prop("circle")),I(W(e),"toolWidth",m.prop(30)),I(W(e),"name",m.prop("")),I(W(e),"image",m.prop("")),I(W(e),"loading",!1),e}l(e,t);var n=e.prototype;return n.className=function(){return"Modal--large"},n.title=function(){return a.a.translator.trans(D+"title")},n.content=function(){var t=this;return m(".Modal-body",[m(".Form-group",[m(".CarvingContestTools",[w.a.component({disabled:"circle"===this.toolShape(),icon:"fas fa-circle",className:"Button",onclick:function(){t.toolShape("circle")},children:a.a.translator.trans(D+"tools.circle")}),w.a.component({disabled:"square"===this.toolShape(),icon:"fas fa-square",className:"Button",onclick:function(){t.toolShape("square")},children:a.a.translator.trans(D+"tools.square")}),m("input",{type:"range",step:2,min:10,max:50,bidi:this.toolWidth})]),N.component({toolShape:this.toolShape,toolWidth:this.toolWidth,image:this.image})]),m(".Form-group",[m("label",a.a.translator.trans(D+"name")),m("input[type=text].FormControl",{bidi:this.name})]),m(".Form-group",[w.a.component({loading:this.loading,disabled:""===this.name()||""===this.image(),className:"Button Button--primary",children:a.a.translator.trans(D+"submit"),onclick:function(){a.a.store.createRecord("carving-contest-entries").save({name:t.name(),image:t.image()}).then((function(){t.props.oncreate()}))}})])])},e}(T.a),A="clarkwinkelmann-carving-contest.forum.page.",F=function(t){function e(){return t.apply(this,arguments)||this}l(e,t);var n=e.prototype;return n.init=function(){t.prototype.init.call(this),this.refreshEntries()},n.refreshEntries=function(){var t=this;this.entries=null,a.a.request({method:"GET",url:a.a.forum.attribute("apiUrl")+"/carving-contest/entries"}).then((function(e){t.entries=a.a.store.pushPayload(e),m.redraw()}))},n.likeButton=function(t){if(!a.a.forum.attribute("carvingContestCanLike"))return null;var e=t.likes(),n=a.a.session.user&&e&&e.some((function(t){return t===a.a.session.user}));return w.a.component({children:a.a.translator.trans(A+(n?"unlike":"like")),className:"Button Button--link",onclick:function(){t.save({isLiked:!n});var e=t.data.relationships.likes.data;e.some((function(t,n){if(t.id===a.a.session.user.id())return e.splice(n,1),!0})),n||e.unshift({type:"users",id:a.a.session.user.id()})}})},n.whoLiked=function(t){var e=t.likes();if(e&&e.length){var n=e.length>4,o=e.sort((function(t){return t===a.a.session.user?-1:1})).slice(0,n?3:4).map((function(t){return m("a",{href:a.a.route.user(t),config:m.route},t===a.a.session.user?a.a.translator.trans("flarum-likes.forum.post.you_text"):S()(t))}));if(n){var r=e.length-o.length;o.push(m("a",{href:"#",onclick:function(t){t.preventDefault(),a.a.modal.show(new PostLikesModal({post:post}))}},a.a.translator.transChoice("flarum-likes.forum.post.others_link",r,{count:r})))}return m(".Post-likedBy",[B()("far fa-thumbs-up"),a.a.translator.transChoice("flarum-likes.forum.post.liked_by"+(e[0]===a.a.session.user?"_self":"")+"_text",o.length,{count:o.length,users:_()(o)})])}},n.view=function(){var t=this;return null===this.entries?m(".container",m("p",a.a.translator.trans(A+"loading"))):m(".container",[m("h2",a.a.translator.trans(A+"title")),a.a.forum.attribute("carvingContestCanParticipate")?w.a.component({className:"Button Button--primary",onclick:function(){a.a.modal.show(new R({oncreate:function(){a.a.modal.close(),t.refreshEntries()}}))},children:a.a.translator.trans(A+"participate")}):null,m("div",this.entries.map((function(e){return m(".CarvingContestEntry",{key:e.id()},[N.component({image:m.prop(e.image())}),m("h3.CarvingContestEntry--name",e.name()),m("p",[k()(e.user()),S()(e.user())," - ",b()(e.createdAt())]),a.a.forum.attribute("carvingContestCanModerate")?w.a.component({className:"Button Button--icon CarvingContestEntry--delete",icon:"fas fa-trash",onclick:function(){confirm(O()(a.a.translator.trans(A+"delete-confirmation",{name:e.name(),user:e.user()})))&&e.delete().then((function(){t.refreshEntries()}))}}):null,m(".CarvingContestEntry--vote",[t.likeButton(e),t.whoLiked(e)])])})))])},e}(g.a);a.a.initializers.add("clarkwinkelmann/carving-contest",(function(){a.a.store.models["carving-contest-entries"]=d,a.a.routes.carvingContest={path:"/carving-contest",component:F.component()},Object(o.extend)(s.a.prototype,"navItems",(function(t){a.a.forum.attribute("carvingContestCanView")&&t.add("carving-contest",u.a.component({icon:"fas fa-spider",children:a.a.translator.trans("clarkwinkelmann-carving-contest.forum.nav.contest"),href:a.a.route("carvingContest")}))}))}))}]);
//# sourceMappingURL=forum.js.map