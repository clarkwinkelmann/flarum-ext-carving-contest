module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=18)}([function(t,e){t.exports=flarum.core.compat["forum/app"]},,function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,e){t.exports=flarum.core.compat["common/components/Link"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["common/components/Page"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["common/helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["common/helpers/punctuateSeries"]},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,e,n){"use strict";n.r(e);var o=n(9),a=n(0),r=n.n(a),s=n(10),i=n.n(s),c=n(11),u=n.n(c);function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}var d=n(3),f=n.n(d),p=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).name=f.a.attribute("name"),e.image=f.a.attribute("image"),e.createdAt=f.a.attribute("createdAt",f.a.transformDate),e.canLike=f.a.attribute("canLike"),e.user=f.a.hasOne("user"),e.likes=f.a.hasMany("likes"),e}return h(e,t),e.prototype.apiEndpoint=function(){return"/carving-contest/entries"+(this.exists?"/"+this.data.id:"")},e}(f.a),v=n(12),g=n.n(v),b=n(2),C=n.n(b),w=n(13),k=n.n(w),y=n(14),x=n.n(y),B=n(6),M=n.n(B),E=n(15),P=n.n(E),S=n(7),L=n.n(S),I=n(4),_=n.n(I),R=n(5),N=n.n(R),O=n(16),j=n.n(O),A=n(17),D=n.n(A),T=n(8),q=n.n(T),F=function(){function t(){this.mode=void 0,this.brush=void 0,this.previewContext=null,this.imageSourceCanvas=void 0,this.imageSourceContext=void 0,this.drawCanvas=void 0,this.drawContext=void 0,this.onmouseup=void 0,this.drawEnabled=!1}var e=t.prototype;return e.oninit=function(t){var e=this;this.mode=t.attrs.mode,this.brush=t.attrs.brush,this.imageSourceCanvas=document.createElement("canvas"),this.imageSourceCanvas.width=426,this.imageSourceCanvas.height=426,this.imageSourceContext=this.imageSourceCanvas.getContext("2d");var n=new Image;n.src=r.a.forum.attribute("baseUrl")+"/assets/extensions/clarkwinkelmann-carving-contest/pumpkin.jpg",n.onload=function(){e.imageSourceContext.drawImage(n,0,0),e.updatePreview()},this.drawCanvas=document.createElement("canvas"),this.drawCanvas.width=426,this.drawCanvas.height=426,this.drawContext=this.drawCanvas.getContext("2d");var o=t.attrs.image;if(o){var a=new Image;a.src=o,a.onload=function(){e.drawContext.drawImage(a,0,0),e.updatePreview()},a.onerror=function(t){console.error("Error loading image",t)}}this.onmouseup=function(){e.drawEnabled=!1}},e.oncreate=function(t){var e=this;document.addEventListener("mouseup",this.onmouseup),t.dom.addEventListener("mousedown",(function(n){e.drawEnabled=!0,e.mouseMove(t,n)})),t.dom.addEventListener("mousemove",this.mouseMove.bind(this,t)),t.dom.addEventListener("mouseleave",(function(){e.updatePreview()})),this.previewContext=t.dom.querySelector("canvas").getContext("2d"),this.updatePreview()},e.onremove=function(){document.removeEventListener("mouseup",this.onmouseup)},e.view=function(){return m(".CarvingContestPumpkin",m("canvas",{width:426,height:426}))},e.mouseMove=function(t,e){var n=e.target.getBoundingClientRect(),o=e.clientX-n.left,a=e.clientY-n.top;this.drawEnabled&&this.brush&&("color"===this.mode&&this.brush.color?this.drawContext.fillStyle=this.brush.color:this.drawContext.fillStyle="#000",this.drawWithTool(this.drawContext,o,a,!0),t.attrs.onchange&&t.attrs.onchange(this.drawContext.canvas.toDataURL("image/png"))),this.updatePreview({x:o,y:a})},e.drawWithTool=function(t,e,n,o){if(void 0===o&&(o=!1),this.brush){var a=this.brush.width;switch(t.beginPath(),this.brush.shape){case"circle":t.arc(e,n,a/2,0,2*Math.PI);break;case"square":t.rect(e-a/2,n-a/2,a,a)}o?t.fill():t.stroke()}},e.updatePreview=function(t){if(void 0===t&&(t=null),this.previewContext){if(this.previewContext.clearRect(0,0,426,426),"color"===this.mode)this.previewContext.drawImage(this.imageSourceCanvas,0,0),this.previewContext.drawImage(this.drawCanvas,0,0);else{for(var e=this.imageSourceContext.getImageData(0,0,426,426),n=this.drawContext.getImageData(0,0,426,426),o=0;o<e.data.length;o+=4)n.data[o+3]>0&&(e.data[o]=0,e.data[o+1]=0,e.data[o+2]=0,e.data[o+3]=0);this.previewContext.putImageData(e,0,0)}t&&(this.previewContext.strokeStyle="rgba(0,0,0,0.5)",this.previewContext.lineWidth=3,this.drawWithTool(this.previewContext,t.x,t.y))}},t}(),W=function(){this.color=null,this.shape="circle",this.width=30},U="clarkwinkelmann-carving-contest.forum.modal.",z=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).attrs=void 0,e.brush=new W,e.name="",e.image="",e.disabled=!0,e.loading=!1,e}h(e,t);var n=e.prototype;return n.className=function(){return"Modal--large"},n.title=function(){return r.a.translator.trans(U+"title")},n.checkIfDisabled=function(){var t=this.disabled;this.disabled=""===this.name||""===this.image,t!==this.disabled&&m.redraw()},n.colorChoice=function(){var t,e=this,n=r.a.forum.attribute("carvingContestColors");return"all"===n?m("input",{type:"color",value:this.brush.color,onchange:function(t){e.brush.color=t.target.value}}):(t="simple"===n?["#f32501","#ff8d12","#ffe884","#94ae3f","#084f93","#000000"]:r.a.forum.attribute("carvingContestColors").split(","),m("div",t.map((function(t){return m(".CarvingContest-ColorChoice",{style:{backgroundColor:t},onclick:function(){e.brush.color=t},className:e.brush.color===t?"selected":""})}))))},n.colorTools=function(){return r.a.forum.attribute("carvingContestColorMode")?m(".CarvingContestTools",[this.colorChoice()]):null},n.content=function(){var t=this;return m(".Modal-body",[m(".Form-group",[this.colorTools(),m(".CarvingContestTools",[C.a.component({disabled:"circle"===this.brush.shape,icon:"fas fa-circle",className:"Button",onclick:function(){t.brush.shape="circle"}},r.a.translator.trans(U+"tools.circle")),C.a.component({disabled:"square"===this.brush.shape,icon:"fas fa-square",className:"Button",onclick:function(){t.brush.shape="square"}},r.a.translator.trans(U+"tools.square")),m("input",{type:"range",step:2,min:10,max:50,value:this.brush.width,onchange:function(e){t.brush.width=parseInt(e.target.value)}})]),m(F,{mode:r.a.forum.attribute("carvingContestColorMode")?"color":"carve",brush:this.brush,image:this.image,onchange:function(e){t.image=e,t.checkIfDisabled()}})]),m(".Form-group",[m("label",r.a.translator.trans(U+"name")),m("input[type=text].FormControl",{value:this.name,onchange:function(e){t.name=e.target.value,t.checkIfDisabled()}})]),m(".Form-group",[C.a.component({loading:this.loading,disabled:this.disabled,className:"Button Button--primary",onclick:function(){r.a.store.createRecord("carving-contest-entries").save({name:t.name,image:t.image}).then((function(){t.attrs.onsave()}))}},r.a.translator.trans(U+"submit"))])])},e}(q.a),V=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).attrs=void 0,e}h(e,t);var n=e.prototype;return n.className=function(){return"EntryLikesModal Modal--small"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-carving-contest.forum.likes_modal.title")},n.content=function(){return m(".Modal-body",m("ul.EntryLikesModal-list",(this.attrs.entry.likes()||[]).map((function(t){return m("li",m(M.a,{href:r.a.route.user(t)},[L()(t)," ",_()(t)]))}))))},e}(q.a),X="clarkwinkelmann-carving-contest.forum.page.",Y=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).loading=!0,e.moreResults=!1,e.entries=null,e.sort="-createdAt",e}h(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.refresh()},n.loadResults=function(t){var e=r.a.preloadedApiDocument();return e?Promise.resolve(e):r.a.store.find("carving-contest/entries",{page:{offset:t},sort:this.sort})},n.refresh=function(){var t=this;return this.loading=!0,this.entries=null,this.loadResults(0).then((function(e){t.entries=[],t.parseResults(e)}),(function(){t.loading=!1,m.redraw()}))},n.loadMore=function(){this.loading=!0,this.loadResults(this.entries.length).then(this.parseResults.bind(this))},n.parseResults=function(t){[].push.apply(this.entries,t),this.loading=!1,this.moreResults=!!t.payload.links.next,m.redraw()},n.likeButton=function(t){if(!t.canLike())return null;var e=t.likes(),n=r.a.session.user&&e&&e.some((function(t){return t===r.a.session.user}));return C.a.component({className:"Button Button--block"+(n?" Button--primary Button-already-liked":""),onclick:function(){t.save({isLiked:!n});var e=t.data.relationships.likes.data;e.some((function(t,n){return t.id===r.a.session.user.id()&&(e.splice(n,1),!0)})),n||e.unshift({type:"users",id:r.a.session.user.id()})}},n?[m("span.already-liked",[N()("far fa-thumbs-up")," ",r.a.translator.trans(X+"already-liked")]),m("span.remove-like",[N()("far fa-thumbs-down")," ",r.a.translator.trans(X+"unlike")])]:[N()("far fa-thumbs-up")," ",r.a.translator.trans(X+"like")])},n.whoLiked=function(t){var e=t.likes();if(e&&e.length){var n=e.length>4,o=e.sort((function(t){return t===r.a.session.user?-1:1})).slice(0,n?3:4).map((function(t){return m(M.a,{href:r.a.route.user(t)},t===r.a.session.user?r.a.translator.trans("flarum-likes.forum.post.you_text"):_()(t))}));if(n){var a=e.length-o.length;o.push(m("a",{href:"#",onclick:function(e){e.preventDefault(),r.a.modal.show(V,{entry:t})}},r.a.translator.trans("flarum-likes.forum.post.others_link",{count:a})))}return m(".Entry-likedBy",[N()("far fa-thumbs-up"),r.a.translator.trans("flarum-likes.forum.post.liked_by"+(e[0]===r.a.session.user?"_self":"")+"_text",{count:o.length,users:j()(o)})])}},n.participateButton=function(){var t=this;return r.a.session.user?r.a.session.user.attribute("carvingContestCanParticipate")?C.a.component({className:"Button Button--primary",onclick:function(){r.a.modal.show(z,{onsave:function(){r.a.modal.close(),t.refresh()}})}},r.a.translator.trans(X+"participate")):r.a.session.user.attribute("carvingContestCouldParticipate")?C.a.component({className:"Button Button--primary",disabled:!0},r.a.translator.trans(X+"already-participated")):null:null},n.view=function(){var t=this;if(null===this.entries)return m(".container",m("p",r.a.translator.trans(X+"loading")));var e={"-likesCount":r.a.translator.trans(X+"sort.mostLikes"),likesCount:r.a.translator.trans(X+"sort.fewerLikes"),"-createdAt":r.a.translator.trans(X+"sort.mostRecent"),createdAt:r.a.translator.trans(X+"sort.leastRecent")};return m(".container",[m("h2",r.a.translator.trans(X+"title")),this.participateButton()," ",x.a.component({buttonClassName:"Button",label:e[this.sort]},Object.keys(e).map((function(n){var o=e[n],a=t.sort===n;return C.a.component({icon:!a||"fas fa-check",onclick:function(){t.sort=n,t.refresh()},active:a},o)})))," ",C.a.component({icon:"fas fa-sync",className:"Button",onclick:function(){t.refresh()}},r.a.translator.trans(X+"refresh")),m("div",this.entries.map((function(e){return m(".CarvingContestEntry",{key:e.id()},[m(F,{mode:r.a.forum.attribute("carvingContestColorMode")?"color":"carve",image:e.image()}),m("h3.CarvingContestEntry--name",e.name()),m("p",[L()(e.user()),_()(e.user())," - ",P()(e.createdAt())]),r.a.forum.attribute("carvingContestCanModerate")?C.a.component({className:"Button Button--icon CarvingContestEntry--delete",icon:"fas fa-trash",onclick:function(){confirm(D()(r.a.translator.trans(X+"delete-confirmation",{name:e.name(),user:e.user()})))&&e.delete().then((function(){t.refresh()}))}}):null,m(".CarvingContestEntry--vote",[t.likeButton(e),t.whoLiked(e)])])}))),this.loading?k.a.component():this.moreResults?C.a.component({className:"Button",onclick:this.loadMore.bind(this)},r.a.translator.trans(X+"load-more")):null])},e}(g.a);r.a.initializers.add("carving-contest",(function(){r.a.store.models["carving-contest-entries"]=p,r.a.routes.carvingContest={path:"/carving-contest",component:Y},Object(o.extend)(i.a.prototype,"navItems",(function(t){r.a.forum.attribute("carvingContestCanView")&&t.add("carving-contest",u.a.component({icon:"fas fa-spider",href:r.a.route("carvingContest")},r.a.translator.trans("clarkwinkelmann-carving-contest.forum.nav.contest")))}))}))}]);
//# sourceMappingURL=forum.js.map